---
id: codebase-overview
title: Codebase overview
sidebar_label: Codebase overview
---

# Codebase overview

The entire codebase can be broadly split into two parts: UI and Core. 

## User Interface

The UI project (named PixiEditor) is built using WPF. 
All the visible parts (windows, dialogs, controls, overlays, etc.) are defined in various .xaml files.
The UI logic is defined in code behind files (.xaml.cs) and in view models (look up MVVM design pattern if you have no idea what any of this means. 
Some of the logic is separated into other classes, broadly called Models. Here is a non-exhaustive list of the parts of the app implemented in the UI project:

- The layout and styles of all visible parts of the app (`Views`, `Styles` folders)
    - `MainWindow.xaml`: Top menu, Close/Minimize/Collapse buttons, Tools' buttons, All the dockable windows, some fully defined here and some included from other files.
    - `Views/Dialogs`: The xaml and code behind files for all the dialog windows, e.g. New File, Resize Canvas, etc.
    - `Views/UserControls`: User controls and Custom controls used throughout the app. Almost all parts of the app are defined in these controls.
    - ...
- `ViewModelMain` and SubViewModels, they contain UI logic that isn't specific to individual user controls (`ViewModels` folder).
    - `ViewModelMain`: ties all sub view models together
    - `SubViewModels` folder
        - `LayersViewModel`: has commands related to layer manipulation
        - `ColorsViewModel`: has commands that work with palettes and swatches
        - `IoViewModel`: handles mouse and keyboard input from the canvas, forwards it to other viewmodels
        - `DocumentManagerViewModel`: a view model storing all opened documents
        - `DocumentViewModel`: Each opened document has its own instance. Contains all data of a single document: WriteableBitmaps, Layers, Folders, Palette, Swatches, etc.
        - `StructureMemberViewModel`, `LayerViewModel`, `FolderViewModel`: each layer/folder (both are referred to as Structure Members) has its own instance. Includes layer visibility, opacity, blend modes, masks, children (of a folder) etc.
        - ...
- `Helpers` folder, which has:
    - WPF Behaviors
    - WPF Converters
    - Various helper functions and extensions
- Command manager (`Models/Commands` folder), a system that lets you easily declare commands both in C# (via attributes) and in XAML (by using a markup extension). It also manages shortcuts, letting you easily add one to any command.
- This project also includes a lot of classes that doesn't directly interact with the views, stored in `Models` folder.
- ...

## Core

PixiEditor's Core mainly consists of two projects: `ChangeableDocument` and `ChunkyImageLib`.

### ChangeableDocument

ChangeableDocument is a project that takes care of storing all data of a single document. 
It also implements all operations that alter the document in any way, which are called Changes. 
Some examples are: creating a new layer, drawing something, or resizing the canvas. 
ChangeableDocument lets you undo and redo any of those operations one after another, implementing the usual undo/redo functions (Ctrl-Z/Ctrl-Y).

### ChunkyImageLib

ChunkyImageLib is a library that provides an image class called ChunkyImage. 
It is used for the contents of the layers, i.e. when you draw something in the app, it gets drawn on a ChunkyImage, which is stored inside the currently selected layer. 

This class is designed to render the drawing operations as fast as possible while also allowing you to quickly cancel them, restoring the image to the original state. 
This functionality is used to preview some operations before fully committing to drawing them. 
For instance, when you draw a rectangle, you first drag it around to decide where it should be, 
and the "dragging around" part is done by drawing it in some place, then cancelling, drawing in a different place, etc.

### way too detailed, move into a page dedicated to chunkyimagelib

 `ChunkyImageLib` provides an image class specifically tailored to store the canvas layers. It has an interface that allows you to modify image by enqueing various drawing operations. The operations can be cancelled in an efficient way, allowing you to preview the changes before committing them. 

For example it is used when the user transforms a selected area, since the app needs to display the transformed image while it is being moved around. Other examples include drawing shapes, using brushes, and in general to anything that requires continious input from the user with immediate visual feedback.

An image is stored as a set of 256x256 segments, or chunks. The drawing operations are applied individually and independently to each chunk. They are applied in a lazy fashion, chunks are updated to the latest version only if you try to access them. Moreover, there is an option to render chunks in low resolution. All of this enables PixiEditor to display the above mentioned "continuous" operations in a very efficient way: parts of the image not currently on display aren't being rendered, and if you zoom far enough rendering switches to using a low resolution.

### end of way too detailed